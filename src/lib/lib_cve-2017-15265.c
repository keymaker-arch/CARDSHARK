/*
[COMMIT]
fix: 71105998845f
parent: 124751d5e63c

[COMMENT]
multi-event, can be viewed as single-event
compiled with GCC 6.5, defconfig, with KASAN
*/

#define _GNU_SOURCE
#include <stdio.h>
#include <unistd.h>
#include <fcntl.h>
#include <sys/ioctl.h>
#include <pthread.h>
#include <stdlib.h>
#include <sched.h>
#include <sys/syscall.h>
#include <sound/asequencer.h>
#include <sys/types.h>
#include <x86intrin.h>

unsigned long racee_delay=0, racer_delay=9500;

static int fd;
static struct snd_seq_port_info info;

void sys_racee(void)
{
	ioctl(fd, SNDRV_SEQ_IOCTL_CREATE_PORT, &info);
}

void sys_racer(void)
{
	ioctl(fd, SNDRV_SEQ_IOCTL_DELETE_PORT, &info);
}

void do_setup()
{
	fd = open("/dev/snd/seq", 0);
	if(fd == -1)
		perror("[-] open snd seq failed"), exit(-1);
	info.addr.client = 128;
}

void do_cleanup()
{
  return;
}

void setup_one(void)
{
  return;
}

void cleanup_one()
{
  ioctl(fd, SNDRV_SEQ_IOCTL_DELETE_PORT, &info);
}

int sanity_check(void)
{
  return 0;
}
